extends ../layouts/dashboard

block content
  //- Page Header
  include ../partials/header
  - var pageTitle = 'Dashboard Overview'
  - var pageDescription = 'Monitor agent status and system health'

  //- System Status Cards (Alpine.js reactive)
  .grid.grid-cols-1.md_grid-cols-2.lg_grid-cols-4.gap-6.mb-8(x-data="dashboardStats()")
    //- Agent Status Card
    .bg-white.rounded-lg.shadow.p-6
      .flex.items-center.justify-between
        div
          p.text-sm.font-medium.text-gray-600 Agent Status
          p.text-3xl.font-bold.text-gray-900(x-text="agentStatus")
        .w-12.h-12.bg-green-100.rounded-lg.flex.items-center.justify-center
          svg.w-6.h-6.text-green-600(fill="none" stroke="currentColor" viewBox="0 0 24 24")
            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z")

    //- Knowledge Base Count
    .bg-white.rounded-lg.shadow.p-6
      .flex.items-center.justify-between
        div
          p.text-sm.font-medium.text-gray-600 Knowledge Base
          p.text-3xl.font-bold.text-gray-900(x-text="kbCount") 0
          p.text-xs.text-gray-500 documents
        .w-12.h-12.bg-blue-100.rounded-lg.flex.items-center.justify-center
          svg.w-6.h-6.text-blue-600(fill="none" stroke="currentColor" viewBox="0 0 24 24")
            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253")

    //- Tools Count
    .bg-white.rounded-lg.shadow.p-6
      .flex.items-center.justify-between
        div
          p.text-sm.font-medium.text-gray-600 Custom Tools
          p.text-3xl.font-bold.text-gray-900(x-text="toolsCount") 0
          p.text-xs.text-gray-500 loaded
        .w-12.h-12.bg-purple-100.rounded-lg.flex.items-center.justify-center
          svg.w-6.h-6.text-purple-600(fill="none" stroke="currentColor" viewBox="0 0 24 24")
            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z")

    //- Task Templates Count
    .bg-white.rounded-lg.shadow.p-6
      .flex.items-center.justify-between
        div
          p.text-sm.font-medium.text-gray-600 Task Templates
          p.text-3xl.font-bold.text-gray-900(x-text="templatesCount") 0
          p.text-xs.text-gray-500 available
        .w-12.h-12.bg-yellow-100.rounded-lg.flex.items-center.justify-center
          svg.w-6.h-6.text-yellow-600(fill="none" stroke="currentColor" viewBox="0 0 24 24")
            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4")

  //- Quick Actions Grid
  .mb-8
    h2.text-xl.font-bold.text-gray-900.mb-4 Quick Actions
    .grid.grid-cols-1.md_grid-cols-2.lg_grid-cols-3.gap-4
      a.bg-white.rounded-lg.shadow.p-6.hover_shadow-lg.transition-shadow.flex.items-center.gap-4(href="/dashboard/config")
        .w-10.h-10.bg-blue-100.rounded-lg.flex.items-center.justify-center
          svg.w-6.h-6.text-blue-600(fill="none" stroke="currentColor" viewBox="0 0 24 24")
            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z")
        div
          p.font-medium.text-gray-900 Agent Configuration
          p.text-sm.text-gray-600 Update personality and settings

      a.bg-white.rounded-lg.shadow.p-6.hover_shadow-lg.transition-shadow.flex.items-center.gap-4(href="/dashboard/knowledge")
        .w-10.h-10.bg-green-100.rounded-lg.flex.items-center.justify-center
          svg.w-6.h-6.text-green-600(fill="none" stroke="currentColor" viewBox="0 0 24 24")
            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4")
        div
          p.font-medium.text-gray-900 Add Knowledge
          p.text-sm.text-gray-600 Upload documents to knowledge base

      a.bg-white.rounded-lg.shadow.p-6.hover_shadow-lg.transition-shadow.flex.items-center.gap-4(href="/dashboard/tools")
        .w-10.h-10.bg-purple-100.rounded-lg.flex.items-center.justify-center
          svg.w-6.h-6.text-purple-600(fill="none" stroke="currentColor" viewBox="0 0 24 24")
            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4")
        div
          p.font-medium.text-gray-900 Manage Tools
          p.text-sm.text-gray-600 Configure custom tool settings

  //- Recent Activity
  .bg-white.rounded-lg.shadow.p-6
    h2.text-xl.font-bold.text-gray-900.mb-4 Recent Activity
    .space-y-4(x-data="recentActivity()")
      template(x-if="activities.length === 0")
        p.text-gray-500.text-center.py-8 No recent activity

      template(x-for="activity in activities" :key="activity.id")
        .flex.items-start.gap-4.p-4.border.border-gray-200.rounded-lg
          .w-10.h-10.bg-gray-100.rounded-full.flex.items-center.justify-center.flex-shrink-0
            svg.w-5.h-5.text-gray-600(fill="none" stroke="currentColor" viewBox="0 0 24 24")
              path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z")
          div.flex-1
            p.font-medium.text-gray-900(x-text="activity.message")
            p.text-sm.text-gray-500(x-text="activity.timestamp")

  //- Alpine.js Data Functions
  script.
    function dashboardStats() {
      return {
        agentStatus: 'Active',
        kbCount: 0,
        toolsCount: 0,
        templatesCount: 0,

        init() {
          this.loadStats();
        },

        async loadStats() {
          try {
            const response = await fetch('/api/dashboard/stats', {
              headers: {
                'X-CSRF-Token': window.csrfToken
              }
            });

            if (response.ok) {
              const data = await response.json();
              this.agentStatus = data.agentStatus || 'Active';
              this.kbCount = data.kbCount || 0;
              this.toolsCount = data.toolsCount || 0;
              this.templatesCount = data.templatesCount || 0;
            }
          } catch (error) {
            console.error('Failed to load dashboard stats:', error);
          }
        }
      }
    }

    function recentActivity() {
      return {
        activities: [],

        init() {
          this.loadActivity();
        },

        async loadActivity() {
          try {
            const response = await fetch('/api/dashboard/activity', {
              headers: {
                'X-CSRF-Token': window.csrfToken
              }
            });

            if (response.ok) {
              const data = await response.json();
              this.activities = data.activities || [];
            }
          } catch (error) {
            console.error('Failed to load recent activity:', error);
          }
        }
      }
    }
